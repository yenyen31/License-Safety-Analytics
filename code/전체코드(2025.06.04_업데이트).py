# -*- coding: utf-8 -*-
"""ì½”ë“œ.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1jCqO6yK8LYRpiwVDvAOAO2m-KA8kULfR

# **ìš´ì „ë©´í—ˆ ë³´ê¸‰ê³¼ êµí†µì•ˆì „ ìƒê´€ë¶„ì„**

> ë¹…ë°ì´í„°ë¶„ì„_ê¸°ë§í”„ë¡œì íŠ¸_ì´ì˜ˆì€

# ê°œë°œ í™˜ê²½ ì„¸íŒ…

êµ¬ê¸€ ë“œë¼ì´ë¸Œ ë§ˆìš´íŠ¸
"""

from google.colab import drive
drive.mount('/content/drive')

"""ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜"""

!pip install pandas requests scikit-learn matplotlib seaborn geopandas lightgbm shap

import pandas as pd
import os

from google.colab import drive
from IPython.display import display

# ì‹œê°í™”
import matplotlib.pyplot as plt
import matplotlib as mpl

import numpy as np
import seaborn as sns

# í•œê¸€ í°íŠ¸ ì„¤ì¹˜ & ì ìš©
!apt-get update -qq
!apt-get install fonts-nanum -qq

from matplotlib import font_manager

# ë‚˜ëˆ”ê³ ë”• í°íŠ¸ ê²½ë¡œ ì°¾ê¸°
font_path = '/usr/share/fonts/truetype/nanum/NanumGothic.ttf'
font_manager.fontManager.addfont(font_path)
mpl.rc('font', family='NanumGothic')
mpl.rc('axes', unicode_minus=False)  # ìŒìˆ˜ ê¸°í˜¸ ê¹¨ì§ ë°©ì§€

"""í”„ë¡œì íŠ¸ í´ë” êµ¬ì¡°
- data/raw/ â†’ ì›ë³¸ CSV/XML/APIì—ì„œ ë°›ì€ ë°ì´í„°
- data/clean/ â†’ ì •ì œí•œ(ê²°ì¸¡Â·ì´ìƒì¹˜ ì²˜ë¦¬í•œ) ë°ì´í„°
- notebooks/ â†’ Jupyter ë…¸íŠ¸ë¶(EDAÂ·ëª¨ë¸ë§)
- scripts/ â†’ ìˆ˜ì§‘Â·ì „ì²˜ë¦¬ íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸

# ë°ì´í„°ì…‹ ë¶ˆëŸ¬ì˜¤ê¸°
: ê° íŒŒì¼ì„ pd.read_excelë¡œ DataFrameìœ¼ë¡œ ë¡œë“œ

> - ìš´ì „ë©´í—ˆì†Œì§€ì í˜„í™© : license.xlsx
- ìì¹˜êµ¬ë³„ ì¸êµ¬ìˆ˜(ì—°ë ¹ëŒ€) : population.xlsx
- êµí†µì‚¬ê³ í˜„í™©(ì‚¬ê³ ìœ í˜•ë³„) : accident.xlsx
- ìì¹˜êµ¬ë³„ ì¸êµ¬ë°€ë„ : population_density.xlsx
- ìì¹˜êµ¬ë³„ 1ì¸ë‹¹ ì§€ì—­ë‚´ì´ìƒì‚° ë° ìˆ˜ì¤€ì§€ìˆ˜ : per_capita_GDP.xlsx
- ìë™ì°¨ë“±ë¡í˜„í™©ë³´ê³  : car_registration.xlsx
"""

# ìì¹˜êµ¬ë³„ ë©´í—ˆ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
license_df = pd.read_excel('/content/drive/MyDrive/License_Safety_Project/data/clean/license.xlsx')

# ìì¹˜êµ¬ë³„ ì¸êµ¬ í†µê³„
population_df = pd.read_excel('/content/drive/MyDrive/License_Safety_Project/data/clean/population.xlsx')

# ìì¹˜êµ¬ë³„ êµí†µì‚¬ê³  í†µê³„
accident_df = pd.read_excel('/content/drive/MyDrive/License_Safety_Project/data/clean/accident.xlsx')

# ìì¹˜êµ¬ë³„ ì¸êµ¬ ë°€ë„
population_density_df = pd.read_excel('/content/drive/MyDrive/License_Safety_Project/data/clean/population_density.xlsx')

# ìì¹˜êµ¬ë³„ 1ì¸ë‹¹ ì§€ì—­ë‚´ì´ìƒì‚° ë° ìˆ˜ì¤€ì§€ìˆ˜
GDP_df = pd.read_excel('/content/drive/MyDrive/License_Safety_Project/data/clean/GDP.xlsx')

# ìë™ì°¨ ë“±ë¡ í˜„í™© ë³´ê³ 
car_registration_df = pd.read_excel('/content/drive/MyDrive/License_Safety_Project/data/clean/car_registration.xlsx')

"""# ë°ì´í„° ì „ì²˜ë¦¬
- ì»¬ëŸ¼ëª… í‘œì¤€í™” : ëª¨ë“  DataFrameì—ì„œ â€˜ì§€ì—­ì½”ë“œâ€™ ì¹¼ëŸ¼ì„ â€˜region_codeâ€™ë¡œ í†µì¼

ê¸°ë³¸ êµ¬ì¡° ì ê²€
- df.shapeë¡œ í–‰Â·ì—´ ê°œìˆ˜ í™•ì¸
- df.columns.tolist()ë¡œ ì»¬ëŸ¼ëª…ì„ ë¦¬ìŠ¤íŠ¸ë¡œ í™•ë³´
- df.head() / df.info() / df.describe() ë¡œ ì£¼ìš” ê°’Â·íƒ€ì…Â·í†µê³„ ìš”ì•½ í™•ì¸

ì»¬ëŸ¼ ëª©ë¡ ì¶”ì¶œ
- ê° DataFrameì˜ columns.tolist() ê²°ê³¼ë¥¼ ëª¨ì•„ ë°ì´í„°ë³„ ì»¬ëŸ¼ êµ¬ì„±ì„ íŒŒì•…

ë©´í—ˆ ë°ì´í„° ì „ì²˜ë¦¬ - license
"""

# 2) Standardize the column name
license_df.rename(columns={'ì§€ì—­ì½”ë“œ': 'region_code'}, inplace=True)

# 'ì§€ì—­', 'region_code' ì œì™¸í•œ ë‚˜ë¨¸ì§€ ìˆ˜ì¹˜ ì»¬ëŸ¼ë§Œ intë¡œ ë³€í™˜
acc_cols = [c for c in accident_df.columns if c not in ['ì§€ì—­','region_code']]
for col in acc_cols:
    accident_df[col] = (
        pd.to_numeric(accident_df[col].astype(str).str.replace(',',''), errors='coerce')
          .fillna(0)
          .astype(int)
    )

# 3) Quick checks
print("Shape:", license_df.shape)
print("\nColumns:", license_df.columns.tolist())

# 4) Preview and summary
from IPython.display import display
display(license_df.head())
license_df.info()
display(license_df.describe())

license_agg = (
    license_df
    .groupby('region_code')[['1ì¢…ì†Œê³„','2ì¢…ì†Œê³„','2ì¢… ì›ì']]
    .sum()
    .reset_index()
)
license_agg['license_total'] = (
    license_agg['1ì¢…ì†Œê³„'] +
    license_agg['2ì¢…ì†Œê³„'] +
    license_agg['2ì¢… ì›ì']
)

"""êµí†µ ì‚¬ê³  ë°ì´í„° ì •ë³´ ì „ì²˜ë¦¬ - accident"""

# 2) Standardize the column name
accident_df.rename(columns={'ì§€ì—­ì½”ë“œ': 'region_code'}, inplace=True)

# 3) ë‚˜ë¨¸ì§€ ì»¬ëŸ¼ì„ ìˆ«ìí˜•ìœ¼ë¡œ ë³€í™˜
num_cols = [c for c in accident_df.columns if c != 'region_code']
for col in num_cols:
    accident_df[col] = (
        pd.to_numeric(accident_df[col].astype(str).str.replace(',', ''), errors='coerce')
          .fillna(0)
          .astype(int)
    )

# 3) Quick checks
print("Shape:", accident_df.shape)
print("\nColumns:", accident_df.columns.tolist())

# 4) Preview and summary
from IPython.display import display
display(accident_df.head())
accident_df.info()
display(accident_df.describe())

# ì „ì²˜ë¦¬ëœ accident_df ê¸°ì¤€ìœ¼ë¡œ acc_agg ì •ì˜
# num_cols ëŠ” 'region_code'ë¥¼ ì œì™¸í•œ ìˆ˜ì¹˜í˜• ì»¬ëŸ¼ ë¦¬ìŠ¤íŠ¸
num_cols = [c for c in accident_df.columns if c != 'region_code']

acc_agg = (
    accident_df
      .groupby('region_code')['í•©ê³„']
      .sum()
      .reset_index()
      .rename(columns={'í•©ê³„':'accidents'})
)

# ê²°ê³¼ í™•ì¸
print(acc_agg.head())

"""ìì¹˜êµ¬ë³„ ì¸êµ¬ìˆ˜ ë°ì´í„° ì „ì²˜ë¦¬ - population"""

# 2) Standardize the column name
population_df.rename(columns={'ì§€ì—­ì½”ë“œ': 'region_code'}, inplace=True)

# region_codeë‘ 'í–‰ì •ê¸°ê´€' ì œì™¸í•˜ê³  ìˆ«ìí˜•ìœ¼ë¡œ ë³€í™˜
pop_cols = [c for c in population_df.columns if c not in ['region_code','í–‰ì •ê¸°ê´€']]
for col in pop_cols:
    population_df[col] = (
        pd.to_numeric(population_df[col].astype(str).str.replace(',',''), errors='coerce')
          .fillna(0)
          .astype(int)
    )

# 3) Quick checks
print("Shape:", population_df.shape)
print("\nColumns:", population_df.columns.tolist())

# 4) Preview and summary
display(population_df.head())
population_df.info()
display(population_df.describe(include='all'))

"""ìì¹˜êµ¬ë³„ ì¸êµ¬ ë°€ë„ ë°ì´í„° ì „ì²˜ë¦¬ - population_density"""

# 2) Standardize the column name
population_density_df.rename(columns={'ì§€ì—­ì½”ë“œ': 'region_code'}, inplace=True)

# Convert all other columns to int
for col in population_df.columns:
    if col != 'region_code':
        population_df[col] = (
            pd.to_numeric(population_df[col].astype(str).str.replace(',', ''), errors='coerce')
              .fillna(0)
              .astype(int)
        )

# 3) Quick checks
print("Shape:", population_density_df.shape)
print("Columns:", population_density_df.columns.tolist())

# 4) Preview and summary
display(population_density_df.head())
population_density_df.info()
display(population_density_df.describe())

"""1ì¸ë‹¹, ìì¹˜êµ¬ë³„ GDP ë°ì´í„° ì „ì²˜ë¦¬ - GDP"""

# 2) Standardize the column name
GDP_df.rename(columns={'ì§€ì—­ì½”ë“œ': 'region_code'}, inplace=True)

# Convert all other columns (except region_code) to numeric, preserving float where needed
for col in GDP_df.columns:
    if col != 'region_code':
        GDP_df[col] = (
            pd.to_numeric(GDP_df[col].astype(str).str.replace(',', ''), errors='coerce')
              .fillna(0)
        )

# 3) Quick checks
print("Shape:", GDP_df.shape)
print("Columns:", GDP_df.columns.tolist())

# 4) Preview and summary
display(GDP_df.head())
GDP_df.info()
display(GDP_df.describe(include='all'))

"""ìë™ì°¨ ë“±ë¡ í˜„í™© ë°ì´í„° ì „ì²˜ë¦¬ - car_registration"""

# Rename 'ì§€ì—­ì½”ë“œ' to 'region_code'
# If there is a column for district name (e.g., 'ì‹œêµ°êµ¬' or similar), rename to 'region_name'
car_registration_df.rename(columns={'ì§€ì—­ì½”ë“œ': 'region_code'}, inplace=True)

# 'ì‹œêµ°êµ¬','region_code' ì œì™¸í•˜ê³  ìˆ«ìí˜•ìœ¼ë¡œ ë³€í™˜
car_cols = [c for c in car_registration_df.columns if c not in ['ì‹œêµ°êµ¬','region_code']]
for col in car_cols:
    car_registration_df[col] = (
        pd.to_numeric(car_registration_df[col].astype(str).str.replace(',',''), errors='coerce')
          .fillna(0)
          .astype(int)
    )

# 3) Quick checks
print("Shape:", car_registration_df.shape)
print("Columns:", car_registration_df.columns.tolist())

# 4) Preview and summary
display(car_registration_df.head())
car_registration_df.info()
display(car_registration_df.describe(include='all'))

"""# íŒŒìƒ ë³€ìˆ˜ ìƒì„±

> - license_rate:	ì¸êµ¬ ëŒ€ë¹„ ë©´í—ˆ ë³´ìœ  ë¹„ìœ¨
- vehicle_rate:	ì¸êµ¬ ëŒ€ë¹„ ë“±ë¡ ì°¨ëŸ‰ ìˆ˜ ë¹„ìœ¨
- accident_rate:	ì¸êµ¬ ëŒ€ë¹„ ì‚¬ê³  ë°œìƒë¥ 
- fatality_rate:	ì‚¬ê³  ëŒ€ë¹„ ì‚¬ë§ ë¹„ìœ¨ (ì¹˜ëª…ë¥ , ì‚¬ë§ììˆ˜ Ã· ì´ ì‚¬ê³  ê±´ìˆ˜)
- injury_rate:	ì‚¬ê³  ëŒ€ë¹„ ë¶€ìƒ ë¹„ìœ¨ (ë¶€ìƒììˆ˜ Ã· ì´ ì‚¬ê³  ê±´ìˆ˜)
- accident_per_vehicle:	ì°¨ëŸ‰ 1ëŒ€ë‹¹ ì‚¬ê³  ë°œìƒë¥  (ì´ ì‚¬ê³  ê±´ìˆ˜ Ã· ì´ ì°¨ëŸ‰ ìˆ˜)
- accident_per_license:	ë©´í—ˆ 1ëª…ë‹¹ ì‚¬ê³  ë°œìƒë¥  (ì´ ì‚¬ê³  ê±´ìˆ˜ Ã· ì´ ë©´í—ˆ ì†Œì§€ì ìˆ˜)
- accident_per_gdp:	ì´ GDP ëŒ€ë¹„ ì‚¬ê³  ê±´ìˆ˜ ë¹„ìœ¨ (ì´ ì‚¬ê³  ê±´ìˆ˜ Ã· ì´ GDP(ë°±ë§Œì›))
- gdp_per_capita:	ìì¹˜êµ¬ 1ì¸ë‹¹ GRDP (ì²œì› ë‹¨ìœ„)

### íŒŒìƒ ì§€í‘œ ìƒì„±ì„ ìœ„í•œ ì¶”ê°€ ì „ì²˜ë¦¬
"""

import numpy as np

# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
# (ê°€ì •) ê¸°ì¡´ì— ì•„ë˜ ë³€ìˆ˜ê°€ ì´ë¯¸ ì •ì˜ë˜ì–´ ìˆëŠ” ìƒíƒœ:
# license_agg, acc_agg, df_accident, population_df, population_density_df, car_registration_df, GDP_df
# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

# 1) êµí†µì‚¬ê³ (acc_agg) ì»¬ëŸ¼ ì ê²€
print("â–¶ acc_agg ì»¬ëŸ¼:", acc_agg.columns.tolist())
# ë§Œì•½ acc_aggê°€ ë‹¤ìŒê³¼ ê°™ì´ ë§Œë“¤ì–´ì§€ì§€ ì•Šì•˜ë‹¤ë©´, ì•„ë˜ì²˜ëŸ¼ ì¬ì •ì˜ í•´ì£¼ì„¸ìš”:
# acc_agg = (
#     df_accident
#     .pivot_table(
#         index='region_code',
#         columns='êµ¬ë¶„ë³„',
#         values='2024',
#         aggfunc='sum'
#     )
#     .reset_index()
# )
# acc_agg.columns.name = None
# # â€œí•©ê³„â€ â†’ accidents
# if 'í•©ê³„' in acc_agg.columns:
#     acc_agg = acc_agg.rename(columns={'í•©ê³„':'accidents'})
# else:
#     raise KeyError("'í•©ê³„' ì»¬ëŸ¼ì´ acc_aggì— ì—†ìŠµë‹ˆë‹¤.")

# # ì‚¬ë§ììˆ˜(â€œì‚¬ë§ììˆ˜ (ëª…)â€)ì™€ ë¶€ìƒììˆ˜(â€œë¶€ìƒììˆ˜ (ëª…)â€)ê°€ ì¡´ì¬í•˜ë©´ ì»¬ëŸ¼ ì´ë¦„ ë³€ê²½
# if 'ì‚¬ë§ììˆ˜ (ëª…)' in acc_agg.columns:
#     acc_agg = acc_agg.rename(columns={'ì‚¬ë§ììˆ˜ (ëª…)':'deaths'})
# if 'ë¶€ìƒììˆ˜ (ëª…)' in acc_agg.columns:
#     acc_agg = acc_agg.rename(columns={'ë¶€ìƒììˆ˜ (ëª…)':'injuries'})

# 2) car_registration_df ì´ ì°¨ëŸ‰ ìˆ˜ ìƒì„±(â€˜ì´ê³„â€™ ì»¬ëŸ¼ ì‚¬ìš©)
print("â–¶ car_registration_df ì»¬ëŸ¼:", car_registration_df.columns.tolist())
if 'ì´ê³„' not in car_registration_df.columns:
    raise KeyError("'ì´ê³„' ì»¬ëŸ¼ì´ car_registration_dfì— ì—†ìŠµë‹ˆë‹¤.")
car_registration_df['total_vehicles'] = car_registration_df['ì´ê³„']

# 3) GDP_df ì»¬ëŸ¼ëª… ì ê²€
print("â–¶ GDP_df ì»¬ëŸ¼:", GDP_df.columns.tolist())
gdp_rename_map = {}
if 'ì§€ì—­ë‚´ì´ìƒì‚°(ë‹¹í•´ë…„ê°€ê²©) (ë°±ë§Œì›)' in GDP_df.columns:
    gdp_rename_map['ì§€ì—­ë‚´ì´ìƒì‚°(ë‹¹í•´ë…„ê°€ê²©) (ë°±ë§Œì›)'] = 'total_gdp'
if '1ì¸ë‹¹ ì§€ì—­ë‚´ì´ìƒì‚° (ì²œì›)' in GDP_df.columns:
    gdp_rename_map['1ì¸ë‹¹ ì§€ì—­ë‚´ì´ìƒì‚° (ì²œì›)'] = 'gdp_per_capita'
GDP_df = GDP_df.rename(columns=gdp_rename_map)
if 'total_gdp' not in GDP_df.columns or 'gdp_per_capita' not in GDP_df.columns:
    raise KeyError("GDP_dfì— 'total_gdp' ë˜ëŠ” 'gdp_per_capita' ì»¬ëŸ¼ì´ ì—†ìŠµë‹ˆë‹¤.")

# 4) ìì¹˜êµ¬ë³„ í†µí•© DataFrame ìƒì„±
merged_df = license_agg.merge(
    acc_agg[['region_code','accidents']],
    on='region_code', how='inner'
).merge(
    population_df[['region_code','ì´ ê±°ì£¼ììˆ˜']],
    on='region_code', how='inner'
).merge(
    population_density_df[['region_code','ì¸êµ¬ë°€ë„ (ëª…/ã¢)']],
    on='region_code', how='inner'
).merge(
    car_registration_df[['region_code','total_vehicles']],
    on='region_code', how='inner'
).merge(
    GDP_df[['region_code','total_gdp','gdp_per_capita']],
    on='region_code', how='inner'
)

print("\nâ–¶ merged_df ì»¬ëŸ¼:", merged_df.columns.tolist())
display(merged_df.head())

"""### íŒŒìƒ ë³€ìˆ˜ ì§€í‘œ ìƒì„±
- ìƒì„±í•œ ëª¨ë“  íŒŒìƒ ì§€í‘œëŠ” merged_dfì— ì €ì¥
"""

# 5) íŒŒìƒ ì§€í‘œ ìƒì„±
# 5-1) ë©´í—ˆìœ¨
merged_df['license_rate'] = merged_df['license_total'] / merged_df['ì´ ê±°ì£¼ììˆ˜']

# 5-2) ì°¨ëŸ‰ ë¹„ìœ¨
merged_df['vehicle_rate'] = merged_df['total_vehicles'] / merged_df['ì´ ê±°ì£¼ììˆ˜']

# 5-3) ì‚¬ê³ ìœ¨
merged_df['accident_rate'] = merged_df['accidents'] / merged_df['ì´ ê±°ì£¼ììˆ˜']

# 5-4) ì¹˜ëª…ë¥ (fatality_rate)
#    acc_aggì—ëŠ” deaths(ì‚¬ë§ììˆ˜) ì»¬ëŸ¼ì´ ì—†ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ,
#    ë¨¼ì € í™•ì¸í•˜ê³  ì—†ìœ¼ë©´ 0ìœ¼ë¡œ ì±„ì›€
if 'deaths' in acc_agg.columns:
    merged_df = merged_df.merge(
        acc_agg[['region_code','deaths']],
        on='region_code', how='left'
    )
    merged_df['deaths'] = merged_df['deaths'].fillna(0).astype(int)
else:
    merged_df['deaths'] = 0

merged_df['fatality_rate'] = np.where(
    merged_df['accidents'] > 0,
    merged_df['deaths'] / merged_df['accidents'],
    0
)

# 5-5) ë¶€ìƒë¥ (injury_rate)
#    acc_aggì— injuries(ë¶€ìƒììˆ˜) ì»¬ëŸ¼ì´ ì—†ìœ¼ë©´ 0ìœ¼ë¡œ ì±„ì›€
if 'injuries' in acc_agg.columns:
    merged_df = merged_df.merge(
        acc_agg[['region_code','injuries']],
        on='region_code', how='left'
    )
    merged_df['injuries'] = merged_df['injuries'].fillna(0).astype(int)
else:
    merged_df['injuries'] = 0

merged_df['injury_rate'] = np.where(
    merged_df['accidents'] > 0,
    merged_df['injuries'] / merged_df['accidents'],
    0
)

# 5-6) ì°¨ëŸ‰ 1ëŒ€ë‹¹ ì‚¬ê³  ë°œìƒë¥ 
merged_df['accident_per_vehicle'] = np.where(
    merged_df['total_vehicles'] > 0,
    merged_df['accidents'] / merged_df['total_vehicles'],
    0
)

# 5-7) ë©´í—ˆ 1ëª…ë‹¹ ì‚¬ê³  ë°œìƒë¥ 
merged_df['accident_per_license'] = np.where(
    merged_df['license_total'] > 0,
    merged_df['accidents'] / merged_df['license_total'],
    0
)

# 5-8) GDP ëŒ€ë¹„ ì‚¬ê³  ê±´ìˆ˜ ë¹„ìœ¨
merged_df['accident_per_gdp'] = np.where(
    merged_df['total_gdp'] > 0,
    merged_df['accidents'] / merged_df['total_gdp'],
    0
)

# 5-9) gdp_per_capita ì»¬ëŸ¼ì€ ì´ë¯¸ ì¡´ì¬í•˜ë¯€ë¡œ ìƒëµ

# 6) íŒŒìƒì§€í‘œ ê²°ê³¼ í™•ì¸
pd.set_option('display.float_format', lambda x: f"{x:.4f}")
print("\nâ–¶ íŒŒìƒ ì§€í‘œ ì˜ˆì‹œ:")
display(
    merged_df[[
        'region_code',
        'license_rate','vehicle_rate','accident_rate',
        'fatality_rate','injury_rate',
        'accident_per_vehicle','accident_per_license',
        'accident_per_gdp','gdp_per_capita'
    ]].head(10)
)

"""# ìƒê´€ê´€ê³„ ë¶„ì„

### ë©´í—ˆìœ¨, ì‚¬ê³ ìœ¨ì˜ ìƒê´€ê´€ê³„
"""

print(accident_df.columns.tolist())
print(acc_agg.head())

"""ë©´í—ˆìœ¨, ì‚¬ê³ ìœ¨ ê³„ì‚°"""

# ë©´í—ˆìœ¨, ì‚¬ê³ ìœ¨ ê³„ì‚°
license_rates = license_agg.merge(
    population_df[['region_code','ì´ ê±°ì£¼ììˆ˜']], on='region_code')

license_rates['license_rate'] = license_rates['license_total'] / license_rates['ì´ ê±°ì£¼ììˆ˜']

accident_rates = acc_agg.merge(
    population_df[['region_code','ì´ ê±°ì£¼ììˆ˜']], on='region_code')

accident_rates['accident_rate'] = (
    accident_rates['accidents'] / accident_rates['ì´ ê±°ì£¼ììˆ˜'])

# í™•ì¸
display(license_rates.head())
display(accident_rates.head())

"""ë©´í—ˆìœ¨ê³¼ ì‚¬ê³ ìœ¨ì˜ ìƒê´€ê´€ê³„"""

# 1) Merge license_rates and accident_rates into a single DataFrame
rates_df = pd.merge(
    license_rates[['region_code', 'license_rate']],
    accident_rates[['region_code', 'accident_rate']],
    on='region_code'
)

# ì‹œê°í™”
# 2) Scatter plot: License Rate vs Accident Rate
plt.figure()
plt.scatter(rates_df['license_rate'], rates_df['accident_rate'])
plt.xlabel('License Rate')
plt.ylabel('Accident Rate')
plt.title('Relationship between License Rate and Accident Rate')
plt.tight_layout()
plt.show()

"""### GRDPê³¼ ì‚¬ê³ ìœ¨ ìƒê´€ê´€ê³„"""

# 3) Merge accident_rates with GDP per capita
df = accident_rates.merge(
    GDP_df[['region_code', '1ì¸ë‹¹ ì§€ì—­ë‚´ì´ìƒì‚° (ì²œì›)']],
    on='region_code',
    how='left'
)

# 4) Compute correlation
corr = df['accident_rate'].corr(df['1ì¸ë‹¹ ì§€ì—­ë‚´ì´ìƒì‚° (ì²œì›)'])
print(f"Correlation between per-capita GRDP and accident rate: {corr:.3f}")

# 5) Scatter plot
plt.figure(figsize=(6, 4))
plt.scatter(df['1ì¸ë‹¹ ì§€ì—­ë‚´ì´ìƒì‚° (ì²œì›)'], df['accident_rate'])
plt.xlabel('Per-Capita GRDP (ì²œì›)')
plt.ylabel('Accident Rate')
plt.title('Per-Capita GRDP vs Accident Rate')
plt.tight_layout()
plt.show()

"""### ìë™ì°¨ ë“±ë¡ëŒ€ìˆ˜ì™€ ì‚¬ê³ ìœ¨ ìƒê´€ê´€ê³„"""

# Sum accident types by region_code
acc_pivot = (
    accident_df
    .groupby('region_code')[['ì°¨ëŒ€ì‚¬ëŒ', 'ì°¨ëŒ€ì°¨', 'ì°¨ëŸ‰ë‹¨ë…']]
    .sum()
    .reset_index()
)


print(acc_pivot.head())

# Sum registered vehicles by region_code
car_pivot = (
    car_registration_df
      .groupby('region_code')[['ì´ê³„']]
      .sum()
      .reset_index()
      .rename(columns={'ì´ê³„':'total_vehicles'})
)

print(car_pivot.head())

# Merge accident data and car registration data
df_merged = acc_pivot.merge(car_pivot, on='region_code', how='left')

# Calculate accident rate per 10,000 vehicles (example metric)
# Handle potential division by zero
df_merged['accidents_per_10k_vehicles'] = (
    (df_merged[['ì°¨ëŒ€ì‚¬ëŒ', 'ì°¨ëŒ€ì°¨', 'ì°¨ëŸ‰ë‹¨ë…']].sum(axis=1) /
     df_merged['total_vehicles']) * 10000
)
df_merged.replace([np.inf, -np.inf], np.nan, inplace=True) # Replace inf with NaN
df_merged.dropna(subset=['accidents_per_10k_vehicles', 'total_vehicles'], inplace=True) # Drop rows with NaN

# Compute correlation between total vehicles and accidents per 10k vehicles
corr_vehicles = df_merged['total_vehicles'].corr(df_merged['accidents_per_10k_vehicles'])
print(f"Correlation between total registered vehicles and accidents per 10k vehicles: {corr_vehicles:.3f}")

# Scatter plot
plt.figure(figsize=(8, 5))
plt.scatter(df_merged['total_vehicles'], df_merged['accidents_per_10k_vehicles'])
plt.xlabel('Total Registered Vehicles')
plt.ylabel('Accidents per 10,000 Vehicles')
plt.title('Total Vehicles vs Accidents per 10,000 Vehicles')
plt.tight_layout()
plt.show()

"""### ì¸êµ¬ë°€ë„ì™€ ì‚¬ê³ ìœ¨ì˜ ìƒê´€ê´€ê³„"""

# ì‚¬ê³  í•©ê³„(í•©ê³„ ì»¬ëŸ¼)ë¥¼ ì§€ì—­ë³„ë¡œ ì§‘ê³„
acc_agg = (accident_df
           .groupby('region_code')['í•©ê³„']
           .sum()
           .reset_index()
           .rename(columns={'í•©ê³„':'accidents'}))

population_df['ì´ ê±°ì£¼ììˆ˜'] = pd.to_numeric(
    population_df['ì´ ê±°ì£¼ììˆ˜'].astype(str).str.replace(',',''),
    errors='coerce'
).fillna(0).astype(int)

# ì‚¬ê³ ìœ¨ ê³„ì‚°
accident_rates = acc_agg.merge(
    population_df[['region_code','ì´ ê±°ì£¼ììˆ˜']],
    on='region_code'
)
accident_rates['accident_rate'] = (
    accident_rates['accidents'] / accident_rates['ì´ ê±°ì£¼ììˆ˜']
)

# 3) ì´ì œ ë³‘í•©
df_corr = accident_rates.merge(
    population_density_df[['region_code','ì¸êµ¬ë°€ë„ (ëª…/ã¢)']],
    on='region_code',
    how='inner'
)

# 4) ê°’ ë¶„í¬ ì ê²€
print(df_corr[['accident_rate','ì¸êµ¬ë°€ë„ (ëª…/ã¢)']].describe())

# 5) ìƒê´€ê³„ìˆ˜ ê³„ì‚°
corr_value = df_corr['ì¸êµ¬ë°€ë„ (ëª…/ã¢)'].corr(df_corr['accident_rate'])
print(f"Correlation: {corr_value:.3f}")

# ì‹œê°í™”
# Scatter plot
plt.figure(figsize=(6, 4))
plt.scatter(df_corr['ì¸êµ¬ë°€ë„ (ëª…/ã¢)'], df_corr['accident_rate'])
plt.xlabel('Population Density (ëª…/ã¢)')
plt.ylabel('Accident Rate')
plt.title('Population Density vs Accident Rate')
plt.tight_layout()
plt.show()

"""### ì‚¬ê³ ê°€ ë§ì€ ìì¹˜êµ¬ ìƒìœ„ 10ê°œ ëŒ€ìƒ, ì‚¬ê³  ìœ í˜• ë¹„ìœ¨ ë¶„ì„"""

# ì‚¬ê³  ìœ í˜•ë³„ ë¶„í¬ë¥¼ ìœ„í•´ í•„ìš”í•œ ì»¬ëŸ¼ë§Œ ì„ íƒ
accident_types_df = accident_df[['region_code', 'ì°¨ëŒ€ì‚¬ëŒ', 'ì°¨ëŒ€ì°¨', 'ì°¨ëŸ‰ë‹¨ë…']]

# 'í•©ê³„' ì»¬ëŸ¼ ìƒì„± (ê° ì‚¬ê³  ìœ í˜•ì˜ í•©)
accident_types_df['í•©ê³„'] = accident_types_df[['ì°¨ëŒ€ì‚¬ëŒ', 'ì°¨ëŒ€ì°¨', 'ì°¨ëŸ‰ë‹¨ë…']].sum(axis=1)

# í•©ê³„ ê¸°ì¤€ìœ¼ë¡œ ìƒìœ„ 10ê°œ ìì¹˜êµ¬ ì„ íƒ
top_10_districts = (
    accident_types_df
    .groupby('region_code')['í•©ê³„']
    .sum()
    .sort_values(ascending=False)
    .head(10)
    .index.tolist()
)

# ìƒìœ„ 10ê°œ ìì¹˜êµ¬ ë°ì´í„° í•„í„°ë§
accident_top10 = accident_types_df[accident_types_df['region_code'].isin(top_10_districts)]

# ì‹œê°í™”ë¥¼ ìœ„í•´ ë°ì´í„° ì¬êµ¬ì„±
accident_top10_melted = accident_top10.melt(
    id_vars=['region_code'],
    value_vars=['ì°¨ëŒ€ì‚¬ëŒ', 'ì°¨ëŒ€ì°¨', 'ì°¨ëŸ‰ë‹¨ë…'],
    var_name='ì‚¬ê³ ìœ í˜•',
    value_name='ì‚¬ê³ ê±´ìˆ˜'
)

# ê° ìì¹˜êµ¬ë³„ ì‚¬ê³  ìœ í˜• í•©ê³„ ê³„ì‚°
accident_top10_agg = (
    accident_top10_melted
    .groupby(['region_code', 'ì‚¬ê³ ìœ í˜•'])['ì‚¬ê³ ê±´ìˆ˜']
    .sum()
    .reset_index()
)

# ì‹œê°í™”
# ìŠ¤íƒí˜• ë°” ì°¨íŠ¸ ì‹œê°í™”
plt.figure(figsize=(10, 6))

sns.set_theme(style="whitegrid")
sns.barplot(
    x='region_code',
    y='ì‚¬ê³ ê±´ìˆ˜',
    hue='ì‚¬ê³ ìœ í˜•',
    data=accident_top10_agg,
    estimator=sum,
    ci=None,
    palette='viridis',
    dodge=False # ìŠ¤íƒí˜•ìœ¼ë¡œ ë§Œë“¤ê¸° ìœ„í•´ False
)

plt.title('Top 10 ìì¹˜êµ¬ì˜ ì‚¬ê³  ìœ í˜•ë³„ ë¶„í¬', fontsize=15)
plt.xlabel('ìì¹˜êµ¬', fontsize=12)
plt.ylabel('ì‚¬ê³  ê±´ìˆ˜', fontsize=12)
plt.xticks(rotation=45, ha='right') # ìì¹˜êµ¬ ì´ë¦„ì´ ê²¹ì¹˜ì§€ ì•Šë„ë¡ íšŒì „
plt.legend(title='ì‚¬ê³  ìœ í˜•')
plt.tight_layout() # ë ˆì´ì•„ì›ƒ ìë™ ì¡°ì •
plt.show()

"""# EDA (ìƒê´€ë¶„ì„ + ì‹œê°í™”)"""

import seaborn as sns
import matplotlib.pyplot as plt
from scipy.stats import zscore

# í•œê¸€ í°íŠ¸ ì„¤ì • (colabìš©)
plt.rc('font', family='NanumGothic')
plt.rcParams['axes.unicode_minus'] = False

# ë¶„ì„ ëŒ€ìƒ íŒŒìƒ ë³€ìˆ˜ ëª©ë¡
eda_vars = [
    'license_rate', 'vehicle_rate', 'accident_rate',
    'fatality_rate', 'injury_rate',
    'accident_per_vehicle', 'accident_per_license',
    'accident_per_gdp', 'gdp_per_capita'
]

# 1. íˆìŠ¤í† ê·¸ë¨ & ë°•ìŠ¤í”Œë¡¯
for col in eda_vars:
    fig, axes = plt.subplots(1, 2, figsize=(12, 4))

    sns.histplot(merged_df[col], bins=20, kde=True, ax=axes[0], color='skyblue')
    axes[0].set_title(f'{col} - ë¶„í¬ íˆìŠ¤í† ê·¸ë¨')

    sns.boxplot(x=merged_df[col], ax=axes[1], color='lightcoral')
    axes[1].set_title(f'{col} - ë°•ìŠ¤í”Œë¡¯ (ì´ìƒê°’ í™•ì¸)')

    plt.tight_layout()
    plt.show()

# 2. ìƒê´€ê´€ê³„ íˆíŠ¸ë§µ
corr_matrix = merged_df[eda_vars].corr()

plt.figure(figsize=(10, 8))
sns.heatmap(corr_matrix, annot=True, cmap='coolwarm', fmt=".2f", square=True)
plt.title("ğŸ“Œ íŒŒìƒ ë³€ìˆ˜ ê°„ ìƒê´€ê´€ê³„ íˆíŠ¸ë§µ")
plt.tight_layout()
plt.show()

# 3. ì£¼ìš” ìƒê´€ì¡°í•© ì‚°ì ë„ (ìƒìœ„ ìƒê´€ê³„ìˆ˜ ì¡°í•©ë§Œ)
from itertools import combinations

high_corr_pairs = []
for x, y in combinations(eda_vars, 2):
    corr_val = merged_df[x].corr(merged_df[y])
    if abs(corr_val) > 0.6:
        high_corr_pairs.append((x, y, corr_val))

# ì‹œê°í™”
for x, y, corr_val in high_corr_pairs:
    plt.figure(figsize=(6, 4))
    sns.scatterplot(x=merged_df[x], y=merged_df[y])
    plt.title(f'{x} vs {y} (corr={corr_val:.2f})')
    plt.xlabel(x)
    plt.ylabel(y)
    plt.tight_layout()
    plt.show()

# 4. ì´ìƒê°’ íƒì§€ (z-score ê¸°ì¤€)
z_scores = merged_df[eda_vars].apply(zscore)
outlier_flags = (np.abs(z_scores) > 3).sum(axis=1)
outliers = merged_df[outlier_flags > 0]

print(f"ì´ìƒê°’ í¬í•¨ ìì¹˜êµ¬ ìˆ˜: {outliers.shape[0]}")
display(outliers[['region_code'] + eda_vars])

"""# í´ëŸ¬ìŠ¤í„°ë§ (K-means)

í´ë¦¬ìŠ¤í„°ë§
"""

from sklearn.preprocessing import StandardScaler
from sklearn.cluster import KMeans
from sklearn.metrics import silhouette_score
import matplotlib.pyplot as plt
import pandas as pd

# í´ëŸ¬ìŠ¤í„°ë§ ëŒ€ìƒ ë³€ìˆ˜
cluster_features = [
    'license_rate', 'vehicle_rate', 'accident_rate',
    'fatality_rate', 'accident_per_license',
    'accident_per_vehicle', 'accident_per_gdp', 'gdp_per_capita'
]

# 1. ê²°ì¸¡ì¹˜ ì œê±° ë° ì§€ì—­ì½”ë“œ í¬í•¨
cluster_df = merged_df[['region_code'] + cluster_features].dropna()

# 2. í‘œì¤€í™”
scaler = StandardScaler()
X_scaled = scaler.fit_transform(cluster_df[cluster_features])

# 3. ìµœì  í´ëŸ¬ìŠ¤í„° ìˆ˜ íƒìƒ‰ (2~8 ë²”ìœ„)
silhouette_scores = {}
for k in range(2, 9):
    kmeans = KMeans(n_clusters=k, random_state=42, n_init=10)
    labels = kmeans.fit_predict(X_scaled)
    score = silhouette_score(X_scaled, labels)
    silhouette_scores[k] = score

# 4. ìµœì  K ì„ íƒ
best_k = max(silhouette_scores, key=silhouette_scores.get)
print(f"â–¶ ìµœì  K: {best_k}, Silhouette Score: {silhouette_scores[best_k]:.3f}")

# 5. ìµœì¢… ëª¨ë¸ í•™ìŠµ ë° í´ëŸ¬ìŠ¤í„° í• ë‹¹
final_kmeans = KMeans(n_clusters=best_k, random_state=42, n_init=10)
cluster_labels = final_kmeans.fit_predict(X_scaled)
cluster_df['cluster'] = cluster_labels

# 6. ë³‘í•©í•˜ì—¬ í™œìš© ê°€ëŠ¥í•˜ê²Œ ë§Œë“¦
merged_df = merged_df.merge(cluster_df[['region_code', 'cluster']], on='region_code', how='left')

# 7. í´ëŸ¬ìŠ¤í„°ë³„ í‰ê· ê°’ í™•ì¸
cluster_profile = (
    cluster_df
    .groupby('cluster')[cluster_features]
    .mean()
    .round(4)
)

# ê²°ê³¼ ì¶œë ¥
print("â–¶ í´ëŸ¬ìŠ¤í„° í”„ë¡œíŒŒì¼")
display(cluster_profile)

"""í´ëŸ¬ìŠ¤í„°ë³„ ì£¼ìš” íŒŒìƒì§€í‘œ ë¶„í¬ ì‹œê°í™” (Boxplot)"""

import matplotlib.pyplot as plt
import seaborn as sns

# ì‚¬ìš©í•  íŒŒìƒ ë³€ìˆ˜ ëª©ë¡
features = [
    'license_rate', 'vehicle_rate', 'accident_rate',
    'fatality_rate', 'injury_rate',
    'accident_per_vehicle', 'accident_per_license',
    'accident_per_gdp', 'gdp_per_capita'
]

# ì‹œê°í™” ìŠ¤íƒ€ì¼ ì„¤ì •
sns.set(style="whitegrid")
plt.figure(figsize=(16, 18))

# í”¼ì²˜ë³„ Boxplot ë°˜ë³µ ìƒì„±
for i, feature in enumerate(features, 1):
    plt.subplot(4, 3, i)
    sns.boxplot(x='cluster', y=feature, data=merged_df, palette='Set2')
    plt.title(f'í´ëŸ¬ìŠ¤í„°ë³„ {feature}', fontsize=12)
    plt.xlabel('Cluster', fontsize=10)
    plt.ylabel(feature, fontsize=10)

plt.tight_layout()
plt.show()

"""# ë¶„ë¥˜ ëª¨ë¸ë§

- ìì¹˜êµ¬ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ â€œê³ ì‚¬ê³  ìœ„í—˜ì§€ì—­(Cluster 0)â€ì„ ë¶„ë¥˜í•˜ëŠ” ëª¨ë¸

ë°ì´í„° ì¤€ë¹„ & ì „ì²˜ë¦¬
"""

from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler

# ì‚¬ìš© ë³€ìˆ˜ ì •ì˜
features = [
    'license_rate', 'vehicle_rate', 'accident_rate',
    'fatality_rate', 'injury_rate',
    'accident_per_vehicle', 'accident_per_license',
    'accident_per_gdp', 'gdp_per_capita'
]

X = merged_df[features]
y = merged_df['cluster']

# í•™ìŠµ/í…ŒìŠ¤íŠ¸ ë°ì´í„° ë¶„ë¦¬
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, stratify=y, random_state=42
)

# ì •ê·œí™”
scaler = StandardScaler()
X_train_scaled = scaler.fit_transform(X_train)
X_test_scaled = scaler.transform(X_test)

"""Random Forest ëª¨ë¸ í•™ìŠµ"""

from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import classification_report, confusion_matrix, roc_auc_score

# ëª¨ë¸ í›ˆë ¨
rf = RandomForestClassifier(n_estimators=100, random_state=42)
rf.fit(X_train_scaled, y_train)

# ì˜ˆì¸¡ ë° í‰ê°€
y_pred = rf.predict(X_test_scaled)
print("ğŸ¯ Random Forest ì„±ëŠ¥ í‰ê°€")
print(classification_report(y_test, y_pred))
print("ROC AUC Score:", roc_auc_score(y_test, rf.predict_proba(X_test_scaled)[:,1]))

"""XGBoost ëª¨ë¸ í•™ìŠµ"""

import xgboost as xgb

xgb_clf = xgb.XGBClassifier(
    n_estimators=100,
    learning_rate=0.1,
    max_depth=3,
    random_state=42,
    use_label_encoder=False,
    eval_metric='logloss'
)
xgb_clf.fit(X_train_scaled, y_train)

# ì˜ˆì¸¡ ë° í‰ê°€
y_pred_xgb = xgb_clf.predict(X_test_scaled)
print("âš¡ XGBoost ì„±ëŠ¥ í‰ê°€")
print(classification_report(y_test, y_pred_xgb))
print("ROC AUC Score:", roc_auc_score(y_test, xgb_clf.predict_proba(X_test_scaled)[:,1]))

"""ë³€ìˆ˜ ì¤‘ìš”ë„ ì‹œê°í™”"""

importances = pd.Series(rf.feature_importances_, index=features)
importances.sort_values(ascending=True).plot(kind='barh', figsize=(8, 6))
plt.title("Random Forest Feature Importances")
plt.tight_layout()
plt.show()

"""# ê°€ì„¤ ê²€ì¦, ì‹œê°í™”"""

# ì‹œê°í™” ìŠ¤íƒ€ì¼ ì„¤ì •
sns.set_theme(style="whitegrid")
plt.rcParams['font.family'] = 'NanumGothic'
plt.rcParams['axes.unicode_minus'] = False

"""1. ê°€ì„¤ 1: ë©´í—ˆìœ¨ì´ ë†’ì„ìˆ˜ë¡ ì‚¬ê³ ìœ¨ì´ ë‚®ë‹¤

"""

# 1. ê°€ì„¤ 1: ë©´í—ˆìœ¨ì´ ë†’ì„ìˆ˜ë¡ ì‚¬ê³ ìœ¨ì´ ë‚®ë‹¤
plt.figure(figsize=(6.5, 5))
sns.regplot(
    x='license_rate',
    y='accident_rate',
    data=merged_df,
    scatter_kws={'s': 60, 'alpha': 0.7},
    line_kws={'color': 'red', 'linewidth': 2}
)
plt.title('ë©´í—ˆìœ¨ê³¼ ì‚¬ê³ ìœ¨ì˜ ê´€ê³„', fontsize=14)
plt.xlabel('ë©´í—ˆìœ¨ (License Rate)', fontsize=12)
plt.ylabel('ì‚¬ê³ ìœ¨ (Accident Rate)', fontsize=12)
plt.tight_layout()
plt.show()

"""ê°€ì„¤ 1: ë©´í—ˆìœ¨ ì™¸ì— ë‹¤ë¥¸ ìš´ì „ ê´€ë ¨ ì§€í‘œì™€ì˜ ìƒê´€ê´€ê³„ë„ í•¨ê»˜ ì‹œê°í™” (heatmap)"""

# ê°€ì„¤ 1 ê´€ë ¨ heatmap
hypo1_cols = [
    'license_rate',
    'accident_rate',
    'accident_per_license',
    'accident_per_vehicle',
    'fatality_rate',
    'injury_rate'
]
plt.figure(figsize=(8, 6))
sns.heatmap(
    merged_df[hypo1_cols].corr(),
    annot=True, cmap='coolwarm', fmt=".2f",
    linewidths=0.5, square=True
)
plt.title('ê°€ì„¤ 1 í™•ì¥ Heatmap: ë©´í—ˆìœ¨ ê´€ë ¨ ìƒê´€ê´€ê³„', fontsize=14)
plt.tight_layout()
plt.show()

"""2. ê°€ì„¤ 2: 1ì¸ë‹¹ GRDPê°€ ë†’ì„ìˆ˜ë¡ ì‚¬ê³ ìœ¨ì´ ë‚®ë‹¤

"""

# 2. ê°€ì„¤ 2: 1ì¸ë‹¹ GRDPê°€ ë†’ì„ìˆ˜ë¡ ì‚¬ê³ ìœ¨ì´ ë‚®ë‹¤
plt.figure(figsize=(6.5, 5))
sns.regplot(
    x='gdp_per_capita',
    y='accident_rate',
    data=merged_df,
    scatter_kws={'s': 60, 'alpha': 0.7},
    line_kws={'color': 'green', 'linewidth': 2}
)
plt.title('1ì¸ë‹¹ GRDPì™€ ì‚¬ê³ ìœ¨ì˜ ê´€ê³„', fontsize=14)
plt.xlabel('1ì¸ë‹¹ GRDP (ì²œì›)', fontsize=12)
plt.ylabel('ì‚¬ê³ ìœ¨ (Accident Rate)', fontsize=12)
plt.tight_layout()
plt.show()

"""ê°€ì„¤2: ê²½ì œë ¥(GDP)ê³¼ ì‚¬ê³  ì§€í‘œ ì „ë°˜ì˜ ìƒê´€ê´€ê³„ ë¶„ì„ (heatmap)"""

# ê°€ì„¤ 2 ê´€ë ¨ heatmap
hypo2_cols = [
    'gdp_per_capita',
    'total_gdp',
    'accident_rate',
    'accident_per_gdp',
    'fatality_rate',
    'injury_rate'
]
plt.figure(figsize=(8, 6))
sns.heatmap(
    merged_df[hypo2_cols].corr(),
    annot=True, cmap='YlGnBu', fmt=".2f",
    linewidths=0.5, square=True
)
plt.title('ê°€ì„¤ 2 í™•ì¥ Heatmap: GRDP ê´€ë ¨ ìƒê´€ê´€ê³„', fontsize=14)
plt.tight_layout()
plt.show()

"""3. ê°€ì„¤ 3: í´ëŸ¬ìŠ¤í„°ë³„ ì°¨ëŸ‰ë‹¹ ì‚¬ê³ ìœ¨ ì°¨ì´ ì¡´ì¬"""

# 3. ê°€ì„¤ 3: í´ëŸ¬ìŠ¤í„°ë³„ ì°¨ëŸ‰ë‹¹ ì‚¬ê³ ìœ¨ ì°¨ì´ ì¡´ì¬
plt.figure(figsize=(7, 5))
sns.boxplot(
    x='cluster',
    y='accident_per_vehicle',
    data=cluster_df,
    palette='Set2',
    showmeans=True,
    meanprops={"marker":"o", "markerfacecolor":"black", "markeredgecolor":"black"}
)
plt.title('í´ëŸ¬ìŠ¤í„°ë³„ ì°¨ëŸ‰ë‹¹ ì‚¬ê³ ìœ¨ ë¶„í¬', fontsize=14)
plt.xlabel('í´ëŸ¬ìŠ¤í„°', fontsize=12)
plt.ylabel('ì°¨ëŸ‰ë‹¹ ì‚¬ê³ ìœ¨', fontsize=12)
plt.tight_layout()
plt.show()

"""í´ëŸ¬ìŠ¤í„° ë‚´ ì£¼ìš” ì§€í‘œ ê°„ì˜ ìƒí˜¸ì‘ìš© í™•ì¸ (heatmap)"""

# ê°€ì„¤ 3 ê´€ë ¨ heatmap
hypo3_cols = [
    'vehicle_rate',
    'accident_per_vehicle',
    'accident_rate',
    'license_rate',
    'fatality_rate',
    'cluster'
]
# clusterê°€ ìˆ«ìì´ë¯€ë¡œ í¬í•¨í•´ë„ ìƒê´€ ì—†ìŒ
plt.figure(figsize=(8, 6))
sns.heatmap(
    cluster_df[hypo3_cols].corr(),
    annot=True, cmap='PuBuGn', fmt=".2f",
    linewidths=0.5, square=True
)
plt.title('ê°€ì„¤ 3 í™•ì¥ Heatmap: ì°¨ëŸ‰ë‹¹ ì‚¬ê³ ìœ¨ ì¤‘ì‹¬ ìƒê´€ê´€ê³„', fontsize=14)
plt.tight_layout()
plt.show()

